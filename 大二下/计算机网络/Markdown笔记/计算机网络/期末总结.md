# 计算机网络概述
1. [[网络应用的体系结构及其特点]]：**C/S模式，P2P模式，混合模式**
2. **ARPAnet**世界上第一个计算机网络、且对计算机网络的形成与发展影响最大，**==标志着现代计算机网络的诞生==**
3. **按覆盖范围分类的计算机网络类型**：==**广域网(WAN)--城域网(MAN)--局域网(LAN)**==
   **广域网的拓扑结构通常采用 网状型**
4. **通信子网**：数据传输服务，==**组成=网络节点+通信链路**==，**网络层及以下**
   **资源子网：信息服务**，**组成=主机系统+各种软件资源和数据服务**，**应用层**
5. **网络协议三要素：语法，语义，同步(时序)**
6. IP电话——分组交换，电报——报文交换，专线电话——电路交换
   **分组交换**：利用率极高，效率高，可靠，主流
   **报文交换**：利用率高，但不可靠，存储容量大延迟高
   **电路交换**：传输速率稳定，不存在信道访问延迟，硬件成本高，连接有延迟
7. **数据封装过程，对应每一层PDU**：==**报文-报文段-数据报-帧-比特**==

## 大题考点
### 1.不同交换的时延计算
**明确：所有交换都需要链路传输实验 = k条链路 × d**
**电路交换时延 = 建立电路连接时间 + 发送数据时间 + 链路传输时间**
**分组交换时延 = 开始发送所有报文时间([x/p]×p/b 报文数量×发送时间)+链路传输时间(kd)+中间链路存储转发时间((k-1)×p/b)**
# 应用层
## 概念记忆
1. **URL的格式**：协议类型://主机名:端口/路径和文件 http:www.szu.edu.cn/index.html
2. **域名和主机名区别**:域名 baidu.com，主机名= www.baidu.com
   **电子邮件 = 用户名@域名，而不是主机名**
3. **Web文档类型：静态文档，动态文档，活动文档**
   **静态文档**：本来就有——一般请求
   **动态文档**：在浏览器访问服务器时才创建
   **活动文档**：服务器将程序发送给客户端，由客户端自己创建
4. **HTTP的端口号**80，**不同版本**1.0 / 1.1,==**无状态协议**==
   服务器不存储任何信息,但是**浏览器可以存储**
5. HTTP请求报文结构：**请求行(方法+URL+HTTP版本号)+报头+空白行+正文**
   **URL不需要协议类型+主机名**，版本号对应1.0/1.1
6. HTTP应答报文： 请求行(HTTP版本+状态码+状态短语)+报头+空白行+正文
	**需要记住的常见状态码：**
	- **200 OK ：请求成功**
	- **202 Accepted：请求被接受，但没有马上起作用**
	- **404 Not found: 文档未发现**
7. **应用层报文丢失，由传输层负责重传--客户机和服务器**
8. **电子邮件**：**邮件传输协议**SMTP，**邮件存储访问协议** POP3,IMAP4,HTTP
   **==SMTP端口号25==,持续连接，报文只能是7位ASCII码——纯文本**
   邮件服务器返回**代码250表示请求命令完成**，继续发送
9. **MIME**：多媒体邮件拓展，不是邮件传输协议，是一种base64编码方式
10. W**eb邮件中，发送和接收邮件的协议都是HTTP**
    因特网邮件系统，发送是SMTP，接收是POP3/IMAP4
    **不管哪种系统，邮件服务器传输邮件都是SMTP**
11. **==FTP：TCP连接 端口号20用于数据连接，端口号21用于控制连接==**
    先控制连接，然后数据连接，最后控制连接释放
    还有一个TFTP使用UDP服务，功能简单——==**TFTP UDP 69**==
	==**考点：FTP和TFTP的区别（四个方面）**==
	   - **传输可靠性**：FTP采用面向连接的TCP服务，TFTP采用UDP，简便
	   - **功能**：FTP除了发送和接收文件，还能列出目录，修改文件等，TFTP只能发送和接收
	   - **数据类型**：FTP指定数据类型，TFTP只能传输7位ASCII码
	   - **用户鉴别**：FTP可以用户鉴别，TFTP不能
12. **匿名FTP：只能下载，不能上传**，用户名Anonymous，密码Guest
13. ==**易错点：控制连接只传输指令，一切设计具体内容的传输都是数据连接**==
14. ***浏览器不能直接登录FTP服务器，需要通过FTP方式***
15. **FTP不适合共享文件读写，​FTP 本质是“文件搬运”而非“共享访问”​**
16. DNS：域名转换为IP地址​，**==UDP上端口号为53==**
    DNS是C/S架构，不依赖于所使用的传输系统(TCP/UDP)
17. **DNS域名解析：递归解析和迭代解析，迭代+递归，高速缓存**
    **本地域名服务器：缓存**
    根服务器-一级域名服务器-二级域名-三级域名服务器
18. **四种解析区别**：
    **高速缓存**：检查本地缓存服务器是否有域名
    **递归解析**：向本地域名服务器请求，一直深入解析，最后返回
    **迭代解析**：由客户端自己向不同服务器迭代
    **递归+迭代**：客户端向服务器发送域名，由本地域名服务器去迭代

**易错点：**
1. **URL无端口号，表示默认端口号80，但是如果题目指定端口号，就不能默认**
   **无路径表示默认根目录，即主页，指定文件则要给定路径**
## 大题考点：
1. **HTTP请求和传输文件，计算时延：**
   1.0 非持续连接 1.1 持续连接
   ==**只有持续连接分为非流水线 / 流水线**==
   串行 / 并行 TCP
   其他文件需要等待HTML解析——增加1个RTT
2. **DNS域名解析算法计算**
   迭代解析：本地域名服务器DNS查询最多4次
   递归解析：本地域名服务器DNS查询1次
3. **==HTTP1.1默认使用持续连接，但是可以通过Connection行改变**==
   Connection=close表示采用非持续连接
   Connection:keep alive 表示采用持续连接
# 传输层

## 概念
1. **传输层：进程到进程——端到端**
2. **传输层最少要提供的功能：==差错校验和复用分解==**
   **==没有重传功能！！！==**
3. **进程标识三元组**：协议，本地IP地址，本地端口号
   **进程通信标识五元组**：协议，本地IP，本地端口号，目的IP，目的端口号
   ==**局域网内的计算机可以使用相同的端口号**==
4. **端口号范围**：熟知端口号(服务器)0~1023，临时端口号(客户端)49152~65535
5. **TCP和UDP总体区别：==可靠，连接，数据，服务，效率和开销==**
   ==**特殊：UDP可以广播，TCP不能**==
6. UDP无连接，不可靠，面向报文，无流量控制
7. **UDP报文格式：报头2 2 2 2 ==源端口号 目的端口== UDP总长度 校验和**
   ==**UDP总长度包含报头+数据**==——数据=UDP总长度-8B
   校验和可选，不选填0，伪首部+UDP数据报 -> 所有16bit求和取反
8. **伪首部**为计算校验和使用，临时，不会传输
   ==**UDP协议号17，TCP协议号6**==
9. TCP特点：面向连接，**可靠**，面向字节流，流量，差错，拥塞控制，不支持广播
   **全双工，并发TCP连接**——==**TCP可靠在于确认机制和重传机制**==
10. TCP报文：固定首部20B，选项填空部分 <=40B
    源端口 2 目的端口 2
    发送序号：表明我的数据开始位置 4B
    确认序号：希望你的数据从哪里开始 4B——==**仅当ACK=1时有效**==
    **TCP报头长度 4bit，以4B为单位**，范围[5,15] 4bit0填充
    TCP控制字段 6bit：每个标志位占1bit，ACK，SYN，FIN 256
    **窗口字段：表示当前最多能接受的字节数 2B(不包括之前发的)** 
    **ack=501,W=1000，表示最大字节序号为1501**
    校验和：2B 紧急指针 2B
11. ==**MSS:Maximum Segment Size 最大报文长度**==
    ==**TCP报文数据部分最大长度，不包含报头，默认536**==
12. ==**TCP三次握手：牢记消耗一个序列号，时延为RTT**==
	发起方:SYN=1,请求建立连接 seq=x
	接收方：SYS=1，ACK=1，同意建立连接，同时建立连接 ack=x+1,seq=y
	发起方：ACK=1，捎带确认，同意建立连接，此时可以一起发送数据 seq=x+1,ack=y+1
13. ==**TCP四次挥手：消耗一个序列号，时延=RTT+数据传输+2MSL**==
    主动释放连接： FIN=1，请求释放连接 seq=u
    被动方： ACK=1，同意释放连接，seq=v,ack=u+1——开始最后的数据传输
    被动方：FIN=1，请求释放连接，seq=t，ack=u+1
    发起方：ACK=1，同意释放连接，seq=u+1,ack=t+1，发送确认报文
    发送方等待2MSL关闭连接
14. ==**2MSL作用：**==
	1. 保证报文有足够的重传时间，最终能顺利到达接收方
	2. 防止旧连接的混淆，保证旧报文全部丢弃
15. [[四个定时器]]
    1. **保持计时器**：服务器发起，防止连接后客户端不发送数据，占用资源
    2. **时间等待计时器**：主动释放连接方发起，等待2MSL
    3. **坚持计时器**：窗口探测，防止陷入死锁
    4. **重传计时器**：报文重传，重传时间由历史往返时间和最新获得的往返时间
16. 流量控制**和拥塞没有任何关系，==唯一取决于接收方的窗口值==**，**流量控制三种窗口**：
    零窗口：表示窗口已满，告知发送方不要发送
    窗口更新：告知发送方窗口剩余量
    窗口探测：为防止陷入死锁，发送方坚持定时器发送窗口探测，纯ACK报文，让接收方发送剩余窗口的通告
17. **拥塞控制**！！！根据网络拥塞状况控制发送方的发送速率
    1. **拥塞控制一定且只能是发送方**， **==发送窗口：Min（通知窗口，拥塞窗口 ）==**
    2. **==通知窗口 rwnd==**:<font color="#ff0000">接收方</font>允许接收的能力，<u>来自接收方流量控制</u>
	3. **==拥塞窗口cwnd==**：<font color="#ff0000">发送方</font>根据网络拥塞情况得出的窗口值，<u>来自发送方的流量控制</u>
18. **慢启动：从1MSS开始，以MSS为单位递增到阙值SST**
    拥塞避免：线性递增，直到出现拥塞
    **两种拥塞状况**：（1）==**连续三个重复的ACK报文(第一个不算)**==——触发快重传，不需要等待重传计时器，从SST减半开始，直接进入拥塞避免（2）**超时重传**：从慢启动开始
    只要发生拥塞，SST必减半成拥塞窗口值的一半
19. 对于接收方缓存更新细节：
    如果题目说接收方存入缓存且不取走——接受方缓存随发送数据减少
    如果是接收方及时清空缓存，保持总量不变——接收方缓存始终不变
## 大题
### 1. 计算发送序号和确认序号
注意：建立连接和结束连接都会消耗一个序列号

e.g.若主机甲与主机乙建立TCP连接时，发送的**SYN段中的序号为1000**，在断开连接时，**主机甲发送给主机乙的FIN段中的序号是5001**，则在无任何重传的情况下，甲向乙已经发送的应用层数据的字节数是
**1000+1~5001-1 = 4000B**

### 2. 考察计时器和确认机制
**A向B连续发送两个报文：**
假设这两个报文顺序到达B，**第一个确认丢失了，第二个确认正常到达A**，请问主机A在什么情况下会进行重传，并指出重传哪个报文？而在什么情况下不进行重传？

重传计时器：重传计时器结束时立即重发，重传第一个报文
累积确认：收到确认报文，表示确认序号之前的都已被收到

所以只有在第二个确认在重传计时器结束之后到达，才会重发第一个报文

### 3.拥塞控制
==**记住：只要TCP发送数据，一定有拥塞控制==**
**==只要出现MSS，一定想起拥塞控制**==
- 拥塞控制会隐藏一个RTT

e.g. 发送方要发送3000B，MSS=1000B，从发起连接时刻开始，到结束连接，需要的时延？
- TCP建立连接：1RTT
- **拥塞窗口初始为1MSS，发送方只能发送1000B：1RTT**
- **拥塞窗口增长为2MSS，发送方发完剩余的2000B：1RTT**
- 释放连接：1RTT
- 服务器不发送数据，发送方等待2MSL：2MSL

==**所有cwnd增长都是以MSS为单位，当MSS=2KB或其他时，小心，拥塞避免每次增加MSS**==

# 网络层
## 概念
1. **标准分类IP地址：ABC单播，==D是广播地址==**
   A:0xx，范围要排除0和127，所以A类地址的范围是1.xx~126.xxx
   B:10 C:110 D:1110
   只要没有CIDR的/标志，那么默认就是标准分类
2. 网络地址：IP地址&子网掩码，**主机号全0**
   广播地址：网络地址前缀不变，**主机号全1**
   网段范围：网络地址+1~广播地址-1，排除主机号全0全1
3. **NAT 网络地址转换技术：互联网和专用网之间的转换，只适合于小型网络**
   局域网：源IP—专用IP地址 -> 目的IP—目的全局IP
   通过NAT转换成 ==**S=全局IP地址（注意端口号也会发生改变）**==， D—目的全局IP
4. IPv6:128位，16B，冒分十六进制，最多8段，一段2B：21DA:0000:...
   ==**零位压缩法：全0(0000) -> 0 ，多段0只能选择压缩一段==**
   **==还有前面的0 00EA -> EA**==
   最多只有一个::
   IPv6内嵌表示：IPv4在最后32位 **IPv4部分必须使用点分十进制表示法**
5. ==**IPv6分组格式：基本头部，扩展头部，数据**==
6. IPv4分组格式记忆：
	1. **版本字段**：4表示IPv4,6表示IPv6——==**不是协议字段**==
	2. **分组头长度**：和TCP一致，以4B为单位，范围[5,15]
	3. **总长度**：字节为单位，和UDP一致，报头+数据
	4. **生存时间TTL**：以跳数来衡量，表示分组在网络中的存活时间-==**TTL=0时，丢弃分组**==
	5. 头部校验和：只有分组头，没有数据部分
	6. ==**标志：0 DF MF**== ——DF表示这个分组是否从分段得到，**==不是从分段得到，DF=1==**
	   **MF：表示后面是否还有分段，如果有的话，MF=1**
	7. ==**段偏移：以8B为单位，相对于第一个分组的数据部分的偏移量，且只看数据部分**==
	   代表的是原始未分片数据报的数据部分中的位置
7. ==**MTU:链路层对IP数据包最大长度的限制**== 
8. **IP数据包分段的==重组在传输层==，路由器只是负责转发**
9. 路由表格式：目的网络-子网掩码-下一跳地址
   直连：下一跳直接写直连
   下一跳地址是路由器的端口地址，路由器会有多个端口IP地址
10. **IP路由汇聚**：相同输出端口的目的IP地址
    根据最长前缀匹配形成一条IP地址
11. **CIDR的路由选择**：首先要匹配网络前缀
    ==**匹配的表项中选择最长前缀匹配**==
12. **路由协议！！！：互联网分为自治系统AS**
    AS内部转发 **IGP：分为RIP协议和OSPF协议**
    AS之间转发 **EGP：BGP协议：到达网络所经过的路径**
13. ==**最佳路径： RIP度量是跳数，OSPF是成本**==
14. **ICMP：封装在IP分组数据部分中**
    两个功能：差错报告和查询报文
    如果一个ICMP差错报文传输中又遇到了问题，**系统不会再生成一个新的ICMP差错报文**
    对于已经分片的分组，**只对第一个分片产生ICMP差错报文**
    **对于组播的分组，不产生ICMP差错报文**
    ==**ICMP的传输是不可靠的，但是可用来进行拥塞控制**==
15. **ARP**：请求广播，响应点播，IP地址转为物理地址
    **RARP**：物理地址转为IP地址
    如果要经过k个路由器转发，ARP协议需要用到k+1次


## 大题考点
### 1. 划分网段
要求主机数时先划分出大网段，再根据剩下的小网段进行划分
==**最大程度划分：K个二进制位划分出K+1个子网**==

### 2. IPv4分组的分段
给定条件：**MTU**，**IP数据报数据大小**，**分组头大小**(固定部分20B)
**最少段数的划分方式——结果：==段偏移+段大小+MF==**

==**解题步骤：**==
1. **计算最少段数** = 数据大小 / (MTU-分组头大小)并且向下找到8的倍数,结果向上取整
2. **分段**： 20B-数据大小，20B-数据大小,...,20B-剩余数据大小
3. **段偏移**： 0，数据大小/8，数据大小/8+段偏移1，...
4. **除了最后一段MF=0，其他MF=1**

e.g. **分组头20B，数据:1800B,MTU=800B**
1. **最少段数**=  (800-20)/8=97.xx -> 1800 / 776 = 2.3 = 3，最少分成3段
2. **分段**： 20B-776B-20B-776B-20B-248B
3. **段偏移**： 0 - 97 - 194
4. **MF**= 1 1 0

### 3. 难点：写路由表
**默认格式： 目的网络 子网掩码 下一跳地址**

**特殊目的：**
- ==**默认路由：目的网络 0.0.0.0 子网掩码0.0.0.0**==
- **特定主机路由**：目的网络是主机IP地址，**子网掩码是255.255.255.255**
- **互联网路由**：==**不关心的目的地都是默认路由**==
- 域名服务器路由：

### 4. 路由协议RIP——向量距离路由协议
**距离向量格式： 目的网络 距离(跳数)**
**直连网络跳数为1，跳数等于16相当于不可达！**
流程：
1. 初始化==**直连网络——跳数为1！**== 
2. 定时器周期向==**周围路由器**==更新路由表
3. ==**按照时间顺序收到路由表，最小路径进行更新，没有选项则添加**==
4. 最小路径 = 收到的距离+1
5. ==**超时计时器：路由表项超过180s没有刷新，就会失效(距离=16)，但不会删除**==

**所以哪怕一个网络无法访问了，但只要路由器收到了到达它的跳数，就会进行更新**
**路由器没有对应的目标网络，又没有默认路由 -> 直接丢弃分组**

### 5. 路由协议OSPF——链路状态协议
向所有路由器发送信息——洪泛法
- 得到所有链路状态信息——链路状态数据库


### 6. IGMP 差错种类
1. 超时：TTL耗尽，减到0，丢弃数据包
2. 路由重定向：下一跳地址与数据包的源主机在同一个网段
3. 参数出错：头部字段存在错误或不完整
4. 目的站不可达：没有任何一条路由，无法找到主机，协议不一致...
5. 源站抑制：网络拥塞,向源主机发送错误报文



# 链路层：

## 概念
1. 交换机转发物理地址，路由器转发逻辑地址(IP地址)